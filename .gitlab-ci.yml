image: "swift:5.1"

stages:
  - test
  - deploy

# before_script:
#   - apt-get update && apt-get install libopus-dev libsodium-dev libcairo2-dev

# test:
#   stage: test
#   script:
#     - swift test

deploy:
  image:
    name: docker/compose:1.24.1
    entrypoint: ["/bin/sh", "-c"]
  stage: deploy
  script:
    - docker build -t setup-d2local Scripts/setup-d2local && docker run -it -v d2local:/d2/local --rm setup-d2local
    - docker-compose build
    - docker-compose up -d
